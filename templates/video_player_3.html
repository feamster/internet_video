{% extends 'base.html' %}

{% block page_content %}
    <script src="http://vjs.zencdn.net/5-unsafe/video.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-resolution-switcher/0.4.2/videojs-resolution-switcher.js"></script>

<main role="main" class="flex-shrink-0">

  <div class="container">
	<div class="video-js-box">
    <br/><br/>
    <br/><br/>
    <video id="video_player" class="video-js vjs-default-skin" fluid="true" controls autoplay data-setup='{"techOrder": ["youtube"], "sources": [{ "type": "video/youtube", "youtube": { "customVars": { "wmode": "transparent" } }}'>
    	{{videosource | safe}}
    </video>

   <script>
    const $ = document.querySelector.bind(document)
    const vid = videojs('video_player')
    const aud = $('#audio')
    vid.on('play', aud.play.bind(aud))
    vid.on('pause', aud.pause.bind(aud))
    let last = vid.currentTime()
    vid.on('timeupdate', e => {
      let cur = vid.currentTime()
      if (Math.abs(cur - last) > 0.5) {
        aud.currentTime = cur
        last = cur
      }
    })
    vid.on('volumechange', e => {
      aud.volume = vid.volume()
    })
  </script>

  <script>
    videojs('video_player').videoJsResolutionSwitcher()
  </script>

  <script type="text/javascript">
    var player = videojs('video_player');

    player.on('resolutionchange', function(){
      console.info('Source changed to %s', player.src())
    })
  </script>


  <script>
    
    var player = videojs('video_player');
    var eventPoller = setInterval(function() {
      var buffered = player.buffered();
      var curTime = player.currentTime();
      for(i=0;i<buffered.length;i++)
      {
        if (buffered.start(i) <= curTime && curTime <= buffered.end(i))
        {
          console.log("Player Time: " + curTime + ", " + "Current Buffer: " + (buffered.end(i) - curTime));
        }
      }

    }, 1000)

  </script>
  </div>
  </div>
</main>
{% endblock %}